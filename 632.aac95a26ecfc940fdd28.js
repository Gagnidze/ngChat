"use strict";(self.webpackChunkng_chat=self.webpackChunkng_chat||[]).push([[632],{632:(I,m,a)=>{a.r(m),a.d(m,{MessengerModule:()=>J});var r=a(8583),l=a(5406),p=a(7985),d=a(7178);class h{constructor(o,n,s,i){this.text=o,this.date=n,this.to=s,this.from=i}}var g=a(1382),u=a(8725),e=a(7716),M=a(4220);let f=(()=>{class t{constructor(){}scroll(n){setTimeout(()=>{n.nativeElement.scrollTop=n.nativeElement.scrollHeight})}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275prov=e.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var c=a(665);const x=["chatBox"];function C(t,o){1&t&&e._UZ(0,"div",19)}function O(t,o){if(1&t&&e._UZ(0,"img",20),2&t){const n=e.oxw().$implicit;e.s9C("src",n[1].imageURL,e.LSH)}}function v(t,o){if(1&t&&(e.TgZ(0,"span",21),e._uU(1),e.qZA()),2&t){const n=e.oxw().$implicit,s=e.oxw();e.xp6(1),e.hij(" ",s.guja[n[0]][1].text," ")}}function P(t,o){1&t&&(e.TgZ(0,"span",22),e._uU(1,"No messages yet"),e.qZA())}const b=function(t){return{"active-chat":t}};function y(t,o){if(1&t){const n=e.EpF();e.TgZ(0,"div",10,11),e.NdJ("click",function(){const _=e.CHM(n).$implicit;return e.oxw().selectChat(_)}),e.TgZ(2,"div",12),e.YNc(3,C,1,0,"div",13),e.YNc(4,O,1,1,"img",14),e.TgZ(5,"div",15),e.TgZ(6,"span",16),e._uU(7),e.qZA(),e.YNc(8,v,2,1,"span",17),e.YNc(9,P,2,0,"span",18),e.qZA(),e.qZA(),e.qZA()}if(2&t){const n=o.$implicit,s=e.oxw();e.xp6(2),e.Q6J("ngClass",e.VKq(6,b,n[1].uid===s.selectedUser)),e.xp6(1),e.Q6J("ngIf",!n[1].imageURL),e.xp6(1),e.Q6J("ngIf",n[1].imageURL),e.xp6(3),e.hij(" ",n[1].username," "),e.xp6(1),e.Q6J("ngIf",s.guja[n[0]]),e.xp6(1),e.Q6J("ngIf",!s.guja[n[0]])}}function Z(t,o){1&t&&(e.TgZ(0,"div",23),e.TgZ(1,"span",24),e._uU(2,"Select someone to chat"),e.qZA(),e.qZA())}function T(t,o){if(1&t&&(e.TgZ(0,"span",35),e._uU(1),e.qZA()),2&t){const n=e.oxw().$implicit;e.xp6(1),e.Oqu(n.text)}}function w(t,o){if(1&t&&(e.TgZ(0,"span",36),e._uU(1),e.qZA()),2&t){const n=e.oxw().$implicit;e.xp6(1),e.Oqu(n.text)}}function U(t,o){if(1&t&&(e.TgZ(0,"div",32),e.YNc(1,T,2,1,"span",33),e.YNc(2,w,2,1,"span",34),e.qZA()),2&t){const n=o.index,s=e.oxw(2);e.xp6(1),e.Q6J("ngIf",s.messages[n].from===s.selectedUser),e.xp6(1),e.Q6J("ngIf",s.messages[n].from!==s.selectedUser)}}function A(t,o){if(1&t){const n=e.EpF();e.TgZ(0,"div",25),e.YNc(1,U,3,2,"div",26),e.TgZ(2,"form",27,28),e.NdJ("ngSubmit",function(){e.CHM(n);const i=e.MAs(3);return e.oxw().send(i)}),e._UZ(4,"input",29),e.TgZ(5,"button",30),e._UZ(6,"i",31),e.qZA(),e.qZA(),e.qZA()}if(2&t){const n=e.oxw();e.xp6(1),e.Q6J("ngForOf",n.messages)}}const F=[{path:"",component:(()=>{class t{constructor(n,s,i){this.store=n,this.router=s,this.utService=i,this.db=(0,d.N8)(),this.dbRef=(0,d.iH)(this.db),this.users=[],this.auth=(0,p.v0)(),this.storage=u.cF(),this.storageRef=u.iH,this.userMessages=[]}ngOnInit(){this.store.select("auth").subscribe(n=>{this.activeUser=n.uid}),(0,d.jM)(this.dbRef,n=>{this.allMsg=n.val().users[this.activeUser].messages,this.store.dispatch((0,g.a3)({payload:{allMessages:this.allMsg}})),this.getData(),this.users=n.val().users,this.userMessages=Object.entries(this.users[this.activeUser].messages),delete this.users[this.activeUser],this.users=Object.entries(this.users),this.userMessages.forEach((s,i)=>{this.userMessages[i][1]=Object.entries(s[1]),this.userMessages[i][1]=this.userMessages[i][1][this.userMessages[i][1].length-1]}),this.guja=Object.fromEntries(this.userMessages)}),this.store.select("data").subscribe(n=>{this.messages=n.messages,this.messages&&(this.messages=Object.values(this.messages))})}getData(){let n;this.store.select("data").subscribe(s=>{console.log("got new data in getData()"),n=s.allMessages[s.selectedUser]}),this.store.dispatch((0,g.aF)({payload:{messages:n}}))}selectChat(n){this.store.dispatch((0,g.dy)({payload:{selectedUser:n[0]}})),this.getData(),this.store.select("data").subscribe(s=>{this.selectedUser=s.selectedUser}),this.utService.scroll(this.chatDiv)}send(n){let s=new h(n.value.text,new Date,this.selectedUser,this.activeUser);console.log(s),this.store.dispatch((0,g.D5)({message:s})),n.reset(),this.getData()}logOut(){(0,p.w7)(this.auth).then(()=>{this.router.navigate(["auth"])})}ngOnDestroy(){}}return t.\u0275fac=function(n){return new(n||t)(e.Y36(M.yh),e.Y36(l.F0),e.Y36(f))},t.\u0275cmp=e.Xpm({type:t,selectors:[["app-messenger"]],viewQuery:function(n,s){if(1&n&&e.Gf(x,5),2&n){let i;e.iGM(i=e.CRH())&&(s.chatDiv=i.first)}},decls:12,vars:3,consts:[[1,"container"],[3,"click"],[1,"users-display"],[1,"heading"],[1,"heading-text"],["class","available-chat",3,"click",4,"ngFor","ngForOf"],[1,"messenger-display"],["chatBox",""],["class","no-user-screen",4,"ngIf"],["class","open-chat",4,"ngIf"],[1,"available-chat",3,"click"],["info",""],[1,"available-chat",3,"ngClass"],["class","image",4,"ngIf"],["class","user-thumbnail","alt","",3,"src",4,"ngIf"],[1,"texts"],[1,"username"],["class","message-preview",4,"ngIf"],["class","message-preview no-messages",4,"ngIf"],[1,"image"],["alt","",1,"user-thumbnail",3,"src"],[1,"message-preview"],[1,"message-preview","no-messages"],[1,"no-user-screen"],[1,"info-message"],[1,"open-chat"],["class","message-box",4,"ngFor","ngForOf"],[1,"send-message-box",3,"ngSubmit"],["msgForm","ngForm"],["autocomplete","off","id","text","type","text","ngModel","","name","text",1,"send-message-input"],["type","submit",1,"send-btn"],[1,"fab","fa-telegram-plane","send-icon"],[1,"message-box"],["class","from-chat chat-message",4,"ngIf"],["class","to-chat chat-message",4,"ngIf"],[1,"from-chat","chat-message"],[1,"to-chat","chat-message"]],template:function(n,s){1&n&&(e.TgZ(0,"div",0),e.TgZ(1,"button",1),e.NdJ("click",function(){return s.logOut()}),e._uU(2,"Log Out"),e.qZA(),e.TgZ(3,"div",2),e.TgZ(4,"div",3),e.TgZ(5,"span",4),e._uU(6,"Messages"),e.qZA(),e.qZA(),e.YNc(7,y,10,8,"div",5),e.qZA(),e.TgZ(8,"div",6,7),e.YNc(10,Z,3,0,"div",8),e.YNc(11,A,7,1,"div",9),e.qZA(),e.qZA()),2&n&&(e.xp6(7),e.Q6J("ngForOf",s.users),e.xp6(3),e.Q6J("ngIf",!s.selectedUser),e.xp6(1),e.Q6J("ngIf",s.selectedUser))},directives:[r.sg,r.O5,r.mk,c._Y,c.JL,c.F,c.Fj,c.JJ,c.On],styles:[".container[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:space-between;height:100vh}.container[_ngcontent-%COMP%]   .users-display[_ngcontent-%COMP%]{display:flex;flex-direction:column;overflow-y:auto}.container[_ngcontent-%COMP%]   .users-display[_ngcontent-%COMP%]   .heading[_ngcontent-%COMP%]{padding:10px 20px}.container[_ngcontent-%COMP%]   .users-display[_ngcontent-%COMP%]   .heading[_ngcontent-%COMP%]   .heading-text[_ngcontent-%COMP%]{font-size:20px;font-weight:500}.container[_ngcontent-%COMP%]   .messenger-display[_ngcontent-%COMP%]{display:flex;flex-direction:column;width:65vw;border:1px solid yellow;overflow-y:auto}.container[_ngcontent-%COMP%]   .messenger-display[_ngcontent-%COMP%]   .no-user-screen[_ngcontent-%COMP%]{background:#e1eec3;background:linear-gradient(to right,#C9D6FF,#E2E2E2);display:flex;justify-content:center;align-items:center;height:100%}.container[_ngcontent-%COMP%]   .messenger-display[_ngcontent-%COMP%]   .no-user-screen[_ngcontent-%COMP%]   .info-message[_ngcontent-%COMP%]{font-size:25px}.container[_ngcontent-%COMP%]   .messenger-display[_ngcontent-%COMP%]   .message-box[_ngcontent-%COMP%]{display:flex;flex-direction:column;margin:7px 0}.container[_ngcontent-%COMP%]   .messenger-display[_ngcontent-%COMP%]   .message-box[_ngcontent-%COMP%]   .chat-message[_ngcontent-%COMP%]{padding:12px;color:#fdfdfd}.container[_ngcontent-%COMP%]   .messenger-display[_ngcontent-%COMP%]   .message-box[_ngcontent-%COMP%]   .from-chat[_ngcontent-%COMP%]{background-color:#b2b2b2;align-items:flex-start;margin-right:10%}.container[_ngcontent-%COMP%]   .messenger-display[_ngcontent-%COMP%]   .message-box[_ngcontent-%COMP%]   .to-chat[_ngcontent-%COMP%]{background-color:#f03e32;align-items:flex-end;margin-left:10%}.container[_ngcontent-%COMP%]   .messenger-display[_ngcontent-%COMP%]   .open-chat[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:flex-end}.container[_ngcontent-%COMP%]   .messenger-display[_ngcontent-%COMP%]   .send-message-box[_ngcontent-%COMP%]{display:flex;flex-direction:row;background-color:#f5f1f0}.container[_ngcontent-%COMP%]   .messenger-display[_ngcontent-%COMP%]   .send-message-box[_ngcontent-%COMP%]   .send-message-input[_ngcontent-%COMP%]{width:100%;padding:10px 25px;background-color:transparent;outline:none;border:none}.container[_ngcontent-%COMP%]   .messenger-display[_ngcontent-%COMP%]   .send-message-box[_ngcontent-%COMP%]   .send-btn[_ngcontent-%COMP%]{border:none;background-color:transparent}.container[_ngcontent-%COMP%]   .messenger-display[_ngcontent-%COMP%]   .send-message-box[_ngcontent-%COMP%]   .send-btn[_ngcontent-%COMP%]   .send-icon[_ngcontent-%COMP%]{font-size:20px;align-self:center;padding-right:8px;cursor:pointer}.container[_ngcontent-%COMP%]   .available-chat[_ngcontent-%COMP%]{display:flex;flex-direction:row;padding:0 5px;width:100%;cursor:pointer}.container[_ngcontent-%COMP%]   .available-chat[_ngcontent-%COMP%]   .image[_ngcontent-%COMP%]{width:45px;height:45px;border-radius:50%;background-color:#000;align-self:center;margin:5px}.container[_ngcontent-%COMP%]   .available-chat[_ngcontent-%COMP%]   .user-thumbnail[_ngcontent-%COMP%]{width:45px;height:45px;border-radius:50px;object-fit:cover;align-self:center;margin:5px}.container[_ngcontent-%COMP%]   .available-chat[_ngcontent-%COMP%]   .texts[_ngcontent-%COMP%]{display:flex;flex-direction:column;padding:5px}.container[_ngcontent-%COMP%]   .available-chat[_ngcontent-%COMP%]   .texts[_ngcontent-%COMP%]   .username[_ngcontent-%COMP%]{font-weight:bold}.container[_ngcontent-%COMP%]   .available-chat[_ngcontent-%COMP%]   .texts[_ngcontent-%COMP%]   .message-preview[_ngcontent-%COMP%]{color:gray}.container[_ngcontent-%COMP%]   .available-chat[_ngcontent-%COMP%]   .texts[_ngcontent-%COMP%]   .no-messages[_ngcontent-%COMP%]{font-style:italic;font-weight:200}.container[_ngcontent-%COMP%]   .available-chat[_ngcontent-%COMP%]   .active-chat[_ngcontent-%COMP%]{background-color:#f5fcfe;border-radius:2px}"]}),t})()}];let j=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=e.oAB({type:t}),t.\u0275inj=e.cJS({imports:[[l.Bz.forChild(F)],l.Bz]}),t})(),J=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=e.oAB({type:t}),t.\u0275inj=e.cJS({imports:[[c.u5,r.ez,j]]}),t})()}}]);